<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace - –ì–ª–∞–≤–Ω–∞—è</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">Marketplace</a>
                
                <div class="nav" id="navContainer">
                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
                    <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="/cart" class="nav-link">
                        <svg class="icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                        –ö–æ—Ä–∑–∏–Ω–∞
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                    <a href="/login" class="nav-link auth-link" id="authLink">
                        <svg class="icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
                        </svg>
                        –í–æ–π—Ç–∏
                    </a>
                    <button class="logout-btn btn btn-secondary" id="logoutBtn" style="display: none;">–í—ã–π—Ç–∏</button>

                    <a href="/admin" class="nav-link admin-link" style="display: none;">
    <svg class="icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
    </svg>
    –ê–¥–º–∏–Ω–∫–∞
</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="margin: 2rem 0; text-align: center;">
            <h1>–õ—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤–∞—Å</h1>
            <p style="color: #6b7280; margin-top: 0.5rem;" id="welcomeMessage">–ù–∞–π–¥–∏—Ç–µ —Ç–æ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ</p>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
        <div style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
            <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                <div style="flex: 1;">
                    <input type="text" id="searchInput" class="form-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." style="width: 100%;">
                </div>
                <select id="categoryFilter" class="form-input" style="width: 200px;">
                    <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </select>
                <select id="sortFilter" class="form-input" style="width: 200px;">
                    <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</option>
                    <option value="price_asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ü–µ–Ω—ã</option>
                    <option value="price_desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é —Ü–µ–Ω—ã</option>
                    <option value="rating">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                </select>
                <button id="applyFilters" class="btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>

        <div class="products-grid" id="productsContainer">
            <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </main>

<script src="/js/app.js"></script>
<script>
// –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤
    initProductsPage();
    
    // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤
    function initProductsPage() {
        loadProducts();
        setupFilters();
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
    async function loadProducts(filters = {}) {
        try {
            console.log('üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:', filters);
            
            let url = '/api/products?';
            if (filters.search) url += `search=${encodeURIComponent(filters.search)}&`;
            if (filters.category && filters.category !== 'all') url += `category=${encodeURIComponent(filters.category)}&`;
            if (filters.sort) url += `sort=${encodeURIComponent(filters.sort)}&`;
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.success) {
                renderProducts(data.products);
                renderCategories(data.categories);
            } else {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', data.error);
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        }
    }
    
    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤
    function renderProducts(products) {
        const container = document.getElementById('productsContainer');
        if (!container) return;
        
        if (!products || products.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                    <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = products.map(product => `
            <div class="product-card">
                <img src="${product.image}" alt="${product.name}" class="product-image">
                <div class="product-info">
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-price">${product.price.toLocaleString()} ‚ÇΩ</p>
                    <p class="product-description">${product.description.substring(0, 100)}...</p>
                    <div class="product-meta">
                        <div class="product-rating">
                            <span>‚òÖ ${product.rating}</span>
                            <span style="color: #6b7280; font-size: 0.9rem;">(${product.reviews})</span>
                        </div>
                        <span class="stock-badge ${product.stock > 0 ? 'stock-in' : 'stock-out'}">
                            ${product.stock > 0 ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                        </span>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <a href="/product/${product.id}" class="btn btn-secondary" style="flex: 1;">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                        <button class="btn add-to-cart" 
                                data-product-id="${product.id}" 
                                data-processing="false"
                                ${product.stock === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                            –í –∫–æ—Ä–∑–∏–Ω—É
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    function renderCategories(categories) {
        const categoryFilter = document.getElementById('categoryFilter');
        if (!categoryFilter || !categories) return;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        const currentValue = categoryFilter.value;
        
        // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ "–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")
        while (categoryFilter.options.length > 1) {
            categoryFilter.remove(1);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categoryFilter.appendChild(option);
        });
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
        if (currentValue && categories.includes(currentValue)) {
            categoryFilter.value = currentValue;
        }
    }
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function setupFilters() {
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const sortFilter = document.getElementById('sortFilter');
        const applyBtn = document.getElementById('applyFilters');
        
        if (!applyBtn) return;
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
        const newApplyBtn = applyBtn.cloneNode(true);
        applyBtn.parentNode.replaceChild(newApplyBtn, applyBtn);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        newApplyBtn.addEventListener('click', () => {
            const filters = {
                search: searchInput ? searchInput.value.trim() : '',
                category: categoryFilter ? categoryFilter.value : 'all',
                sort: sortFilter ? sortFilter.value : ''
            };
            loadProducts(filters);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–∏—Å–∫–µ
        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    newApplyBtn.click();
                }
            });
        }
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
    function showError(message) {
        const container = document.getElementById('productsContainer');
        if (!container) return;
        
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                <h3 style="color: #ef4444;">${message}</h3>
                <button onclick="location.reload()" class="btn" style="margin-top: 1rem;">
                    –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                </button>
            </div>
        `;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ
    window.addEventListener('focus', () => {
        if (window.marketplaceApp) {
            window.marketplaceApp.checkAuth();
            window.marketplaceApp.updateCartCount();
        }
    });
});
</script>
</body>
</html>